// Translation object
        const translations = {
            en: {
                header_title: "MLLD",
                header_subtitle: "A short days service",
                autofill_message: "Powered by BsPsgenerater",
                theme_settings: "Theme Settings",
                theme_dark: "Dark",
                theme_light: "Light",
                font_settings: "Font Settings",
                font_default: "Default",
                font_serif: "Serif",
                language_settings: "Language Settings",
                lang_english: "English",
                lang_telugu: "Telugu",
                amount_details: "Amount details!",
                amount_range: "Amount: 100 - 5000₹",
                repayment_period: "Repayment: 1 - 15 Days",
                terms_repay: "-> Repay within days based on your taken days or late fees apply.",
                terms_interest: "-> Interest on the amount will be based on the balance on amount you take.",
                my_account: "My Account",
                take_money: "Take Money",
                alert_redirect: "Redirecting to the loan application form.",
                how_it_works: "Follow these steps..!",
                step_1: "Think how many days you want the money.",
                step_2: "Click on \"Apply.\"",
                step_3: "Fill out the form.",
                step_4: "Wait a few hours.",
                step_5: "Get funds from your coordinator.",
                step_6: "Check details like interest and etc... in \"My Account.\"",
                step_7: "Repay on time.",
                step_8: "Are you late to return? Say 2 days before we will extend the date (or) Extra fees apply.",
                step_9: "Pay on time for future loans.",
                late_payment: "I'm late",
                late_payment_desc: "If you are late in returning the amount, the interest will double for every 2 hours.",
                contact_us: "Contact us if you think you'll be late so we can help you.",
                long_term_loan: "Can't take for 15+ days?",
                long_term_terms: "-> Yes, you can take as many days as you need, but if you take more than 15 days, you will have to pay a higher interest rate than the standard one.",
                borrow_limit: "Borrow limit",
                borrow_limit_desc: "Click here to take the amounts above ₹5,000....",
                mlending_site: "MLending site",
                footer: "By Myootive",
                verification: "Enter Password",
                enter_password: "Enter your password",
                submit: "Submit",
                error_message: "Incorrect password.",
                settings: "Settings",
                font: "Font",
                language: "Language",
                borrower: "Borrower",
                amount: "Amount",
                taken_amount: "Taken Amount",
                taken_on: "Taken on",
                return_on: "Return on",
                duration: "Duration",
                interest: "Interest",
                overdue_interest: "Overdue Interest",
                total_amount_to_return: "Total Amount to Return",
                repayment_message: "YOU HAVE TO RETURN THIS AMOUNT",
                days: "days"
            },
            te: {
                header_title: "MLLD",
                header_subtitle: "స్వల్ప రోజుల సేవ",
                autofill_message: "BsPsgenerater ద్వారా శక్తివంతం",
                theme_settings: "థీమ్ సెట్టింగులు",
                theme_dark: "చీకటి",
                theme_light: "వెలుగు",
                font_settings: "ఫాంట్ సెట్టింగులు",
                font_default: "డిఫాల్ట్",
                font_serif: "సెరిఫ్",
                language_settings: "భాషా సెట్టింగులు",
                lang_english: "ఇంగ్లీష్",
                lang_telugu: "తెలుగు",
                amount_details: "మొత్తం వివరాలు!",
                amount_range: "మొత్తం: 100 - 5000₹",
                repayment_period: "తిరిగి చెల్లించు: 1 - 15 రోజులు",
                terms_repay: "-> మీరు తీసుకున్న రోజుల ఆధారంగా రోజుల్లో తిరిగి చెల్లించండి లేదా ఆలస్య రుసుము వర్తిస్తుంది.",
                terms_interest: "-> మీరు తీసుకున్న మొత్తం ఆధారంగా వడ్డీ ఉంటుంది.",
                my_account: "నా ఖాతా",
                take_money: "డబ్బు తీసుకోండి",
                alert_redirect: "రుణ దరఖాస్తు ఫారమ్‌కు మళ్లించబడుతోంది.",
                how_it_works: "ఈ దశలను అనుసరించండి..!",
                step_1: "మీకు డబ్బు ఎన్ని రోజులు కావాలో ఆలోచించండి.",
                step_2: "\"అప్లై\" క్లిక్ చేయండి.",
                step_3: "ఫారమ్ నింపండి.",
                step_4: "కొన్ని గంటలు వేచి ఉండండి.",
                step_5: "మీ కోఆర్డినేటర్ నుండి నిధులు పొందండి.",
                step_6: "\"నా ఖాతా\"లో వడ్డీ మరియు ఇతర వివరాలను తనిఖీ చేయండి.",
                step_7: "సమయానికి తిరిగి చెల్లించండి.",
                step_8: "తిరిగి చెల్లించడంలో ఆలస్యమైతే? 2 రోజుల ముందు చెప్పండి, మేము తేదీని పొడిగిస్తాము (లేదా) అదనపు రుసుము వర్తిస్తుంది.",
                step_9: "భవిష్యత్ రుణాల కోసం సమయానికి చెల్లించండి.",
                late_payment: "నేను ఆలస్యమయ్యాను",
                late_payment_desc: "మీరు మొత్తాన్ని తిరిగి చెల్లించడంలో ఆలస్యమైతే, ప్రతి 2 గంటలకు వడ్డీ రెట్టింపు అవుతుంది.",
                contact_us: "మీరు ఆలస్యం అవుతామని భావిస్తే మమ్మల్ని సంప్రదించండి, మేము మీకు సహాయం చేస్తాము.",
                long_term_loan: "15+ రోజుల కోసం తీసుకోలేరా?",
                long_term_terms: "-> అవును, మీకు కావలసినన్ని రోజులు తీసుకోవచ్చు, కానీ 15 రోజుల కంటే ఎక్కువ తీసుకుంటే, సాధారణ రేటు కంటే ఎక్కువ వడ్డీ రేటు చెల్లించాలి.",
                borrow_limit: "రుణ పరిమితి",
                borrow_limit_desc: "₹5,000 పైన మొత్తాలను తీసుకోవడానికి ఇక్కడ క్లిక్ చేయండి....",
                mlending_site: "MLending సైట్",
                footer: "మైయూటివ్ ద్వారా",
                verification: "పాస్‌వర్డ్ నమోదు చేయండి",
                enter_password: "మీ పాస్‌వర్డ్ నమోదు చేయండి",
                submit: "సమర్పించు",
                error_message: "తప్పు పాస్‌వర్డ్.",
                settings: "సెట్టింగులు",
                font: "ఫాంట్",
                language: "భాష",
                borrower: "రుణగ్రహీత",
                amount: "మొత్తం",
                taken_amount: "తీసుకున్న మొత్తం",
                taken_on: "తీసుకున్న తేదీ",
                return_on: "తిరిగి చెల్లించే తేదీ",
                duration: "వ్యవధి",
                interest: "వడ్డీ",
                overdue_interest: "ఆలస్య వడ్డీ",
                total_amount_to_return: "తిరిగి చెల్లించాల్సిన మొత్తం",
                repayment_message: "మీరు ఈ మొత్తాన్ని తిరిగి చెల్లించాలి",
                days: "రోజులు"
            }
        };

        document.addEventListener("DOMContentLoaded", () => {
            const customMenu = document.querySelector(".custom-menu");

            document.addEventListener("click", () => {
                if (customMenu) {
                    customMenu.style.display = "none";
                }
                const settingsPanel = document.getElementById("settingsPanelTop");
                if (settingsPanel && !event.target.closest('.settings-bar') && !event.target.closest('.settings-panel')) {
                    settingsPanel.classList.remove("show");
                }
            });

            const loadingOverlay = document.getElementById("loadingOverlay");
            setTimeout(() => {
                loadingOverlay.classList.add("hidden");
            }, 3000);

            try {
                const savedFont = localStorage.getItem("font") || "default";
                applyFont(savedFont);
                document.getElementById("fontDefaultTop").checked = savedFont === "default";
                document.getElementById("fontSerifTop").checked = savedFont === "serif";
                document.getElementById("fontDefault").checked = savedFont === "default";
                document.getElementById("fontSerif").checked = savedFont === "serif";

                const savedTheme = localStorage.getItem("theme") || "dark";
                applyTheme(savedTheme);
                document.getElementById("themeToggle").checked = savedTheme === "light";
                document.getElementById("themeDarkTop").checked = savedTheme === "dark";
                document.getElementById("themeLightTop").checked = savedTheme === "light";

                const savedLanguage = localStorage.getItem("language") || "en";
                applyLanguage(savedLanguage);
                document.getElementById("langEnglishTop").checked = savedLanguage === "en";
                document.getElementById("langTeluguTop").checked = savedLanguage === "te";
                document.getElementById("langEnglish").checked = savedLanguage === "en";
                document.getElementById("langTelugu").checked = savedLanguage === "te";
            } catch (e) {
                console.error("Error accessing localStorage:", e);
                applyFont("default");
                applyTheme("dark");
                applyLanguage("en");
            }

            window.matchMedia("(prefers-color-scheme: light)").addEventListener("change", (e) => {
                try {
                    if (!localStorage.getItem("theme")) {
                        applyTheme("dark");
                        document.getElementById("themeToggle").checked = false;
                        document.getElementById("themeDarkTop").checked = true;
                        document.getElementById("themeLightTop").checked = false;
                    }
                } catch (e) {
                    console.error("Error checking localStorage on theme change:", e);
                }
            });
        });

        const users = {
            "Ganesh@5577": {
                name: "J Ganesh",
                fineRate: 5,
                profileBackground: "#ffffff00",
                loans: [
                    {
                        planDate: "20-08-2025",
                        endDate: "10-09-2025",
                        interest: 800,
                        takenAmount: 3200,
                        fineRate: 50
                    },
                ]
            }
        };

        let previousSection = null;
        let currentUser = null;

        function showLoginPrompt() {
            const passwordInput = document.getElementById("passwordInput");
            const autofillMessage = document.getElementById("autofillMessage");
            passwordInput.value = "";
            document.getElementById("errorMessage").style.display = "none";
            document.getElementById("passwordSection").style.display = "block";
            document.getElementById("userDetails").style.display = "none";
            document.getElementById("settingsSection").style.display = "none";
            document.getElementById("fontSettingsSection").style.display = "none";
            document.getElementById("languageSettingsSection").style.display = "none";
            document.getElementById("popupTitle").textContent = getTranslation("verification");
            document.getElementById("backBtn").style.display = "none";
            document.getElementById("settingsBtn").style.display = "inline-block";
            document.getElementById("accountPopup").style.display = "flex";
            document.getElementById("popupOverlay").style.display = "block";
            setTimeout(() => {
                document.getElementById("accountPopup").classList.add("show");
                document.getElementById("popupOverlay").classList.add("show");
            }, 10);

            try {
                const storedPassword = localStorage.getItem("savedPassword");
                if (storedPassword && users[storedPassword]) {
                    setTimeout(() => {
                        passwordInput.value = storedPassword;
                        autofillMessage.style.display = "block";
                        autofillMessage.classList.add("show");
                        setTimeout(() => {
                            autofillMessage.classList.remove("show");
                            setTimeout(() => {
                                autofillMessage.style.display = "none";
                            }, 300);
                        }, 1000);
                    }, 500);
                }
            } catch (e) {
                console.error("Error accessing localStorage for password:", e);
            }
            previousSection = null;
        }

        function calculateDaysOverdue(endDate, currentDate) {
            const end = new Date(endDate.split("-").reverse().join("-"));
            const current = new Date(currentDate.split("-").reverse().join("-"));
            const diffTime = current - end;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            return diffDays > 0 ? diffDays : 0;
        }

        function calculateDuration(startDate, endDate) {
            const start = new Date(startDate.split("-").reverse().join("-"));
            const end = new Date(endDate.split("-").reverse().join("-"));
            const diffTime = end - start;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            return diffDays >= 0 ? diffDays : 0;
        }

        function renderUserDetails() {
            if (!currentUser) return;
            const user = users[currentUser];
            const today = new Date().toLocaleDateString("en-GB").split("/").join("-");
            const accountDetails = document.getElementById("accountDetails");
            accountDetails.style.background = user.profileBackground;
            let loansHTML = user.loans.map((loan, index) => {
                const totalAmountToReturn = loan.takenAmount + loan.interest;
                const daysOverdue = calculateDaysOverdue(loan.endDate, today);
                const fineRate = loan.fineRate !== undefined ? loan.fineRate : user.fineRate;
                const fine = daysOverdue * fineRate;
                const duration = calculateDuration(loan.planDate, loan.endDate);
                const repaymentMessage = daysOverdue >= 0 ? 
                    `<center><p style="color: white; font-weight: bold; padding: 9px; border-radius: 2px; font-size: 13px; margin: 0px; border-left: solid 4px; background: red;" data-i18n="repayment_message"></p></center>` : 
                    '';
                return `
                    <div class="loan-item">
                        <h4 style="text-align:center;" data-i18n="amount">${getTranslation("amount")} ${index + 1}</h4>
                        <p><span data-i18n="taken_amount"></span>    <strong>₹${loan.takenAmount}</strong></p>
                        <p><span data-i18n="taken_on"></span>         <strong>${loan.planDate}</strong></p>
                        <p><span data-i18n="return_on"></span>        <strong>${loan.endDate}</strong></p>
                        <p><span data-i18n="duration"></span>         <strong>${duration} <span data-i18n="days"></span></strong></p>
                        <p><span data-i18n="interest"></span>         <strong>₹${loan.interest}</strong></p>
                        <hr>
                        <p><span data-i18n="overdue_interest"></span> <strong>₹${fine}</strong></p>
                        <hr>
                        <p style="color: #00b99e;"><span data-i18n="total_amount_to_return"></span> <strong>₹${totalAmountToReturn + fine}</strong></p>
                        ${repaymentMessage}
                    </div>
                `;
            }).join('');
            accountDetails.innerHTML = `
                <div style="margin: 15px;" class="borrowtop" style="background-color: #212121;">
                    <h2 style="text-align: center; margin: -5px; padding: 0px; font-size: 10px; color: #00a9ff;" data-i18n="borrower"></h2>
                    <p style="text-align: center; display: block; font-size: 16px; margin: 0px; padding: 0px; display: flex; align-items: center; justify-content: center; gap: 5px;"><strong>${user.name}</strong> <img width="15px" src="https://static-cdn.jtvnw.net/badges/v1/d12a2e27-16f6-41d0-ab77-b780518f00a3/3" alt=""></p>
                </div>   
                ${loansHTML}
            `;
            updateTranslations();
        }

        function authenticateUser() {
            const enteredPassword = document.getElementById("passwordInput").value;
            const user = users[enteredPassword];
            const today = new Date().toLocaleDateString("en-GB").split("/").join("-");

            if (user) {
                currentUser = enteredPassword;
                previousSection = "passwordSection";
                try {
                    localStorage.setItem("savedPassword", enteredPassword);
                } catch (e) {
                    console.error("Error saving password to localStorage:", e);
                }

                document.getElementById("passwordSection").style.display = "none";
                document.getElementById("userDetails").style.display = "block";
                document.getElementById("settingsSection").style.display = "none";
                document.getElementById("fontSettingsSection").style.display = "none";
                document.getElementById("languageSettingsSection").style.display = "none";
                document.getElementById("popupTitle").textContent = getTranslation("my_account");
                document.getElementById("backBtn").style.display = "none";
                document.getElementById("settingsBtn").style.display = "inline-block";
                renderUserDetails();
            } else if (enteredPassword === '1907') {
                window.location.href = "https://mfi0212.github.io/MFI/banned";
            } else {
                document.getElementById("errorMessage").style.display = "block";
            }
        }

        function toggleSettingsPanelTop() {
            const settingsPanel = document.getElementById("settingsPanelTop");
            settingsPanel.classList.toggle("show");
        }

        function toggleSettingsPanel() {
            const settingsSection = document.getElementById("settingsSection");
            const fontSettingsSection = document.getElementById("fontSettingsSection");
            const languageSettingsSection = document.getElementById("languageSettingsSection");
            const passwordSection = document.getElementById("passwordSection");
            const userDetails = document.getElementById("userDetails");
            const popupTitle = document.getElementById("popupTitle");
            const backBtn = document.getElementById("backBtn");
            const settingsBtn = document.getElementById("settingsBtn");

            if (settingsSection.style.display === "block") {
                settingsSection.style.display = "none";
                fontSettingsSection.style.display = "none";
                languageSettingsSection.style.display = "none";
                if (previousSection === "userDetails") {
                    userDetails.style.display = "block";
                    popupTitle.textContent = getTranslation("my_account");
                    backBtn.style.display = "none";
                    settingsBtn.style.display = "inline-block";
                    renderUserDetails();
                } else {
                    passwordSection.style.display = "block";
                    popupTitle.textContent = getTranslation("verification");
                    backBtn.style.display = "none";
                    settingsBtn.style.display = "inline-block";
                }
            } else {
                previousSection = userDetails.style.display === "block" ? "userDetails" : (passwordSection.style.display === "block" ? "passwordSection" : previousSection);
                settingsSection.style.display = "block";
                fontSettingsSection.style.display = "none";
                languageSettingsSection.style.display = "none";
                passwordSection.style.display = "none";
                userDetails.style.display = "none";
                popupTitle.textContent = getTranslation("settings");
                backBtn.style.display = previousSection ? "inline-block" : "none";
                settingsBtn.style.display = "none";
            }

            try {
                const savedFont = localStorage.getItem("font") || "default";
                document.getElementById("fontDefault").checked = savedFont === "default";
                document.getElementById("fontSerif").checked = savedFont === "serif";
                const savedLanguage = localStorage.getItem("language") || "en";
                document.getElementById("langEnglish").checked = savedLanguage === "en";
                document.getElementById("langTelugu").checked = savedLanguage === "te";
            } catch (e) {
                console.error("Error updating radio buttons from localStorage:", e);
            }
            updateTranslations();
        }

        function displayFontOptions() {
            const settingsSection = document.getElementById("settingsSection");
            const fontSettingsSection = document.getElementById("fontSettingsSection");
            const languageSettingsSection = document.getElementById("languageSettingsSection");
            const passwordSection = document.getElementById("passwordSection");
            const userDetails = document.getElementById("userDetails");
            const popupTitle = document.getElementById("popupTitle");
            const backBtn = document.getElementById("backBtn");
            const settingsBtn = document.getElementById("settingsBtn");

            previousSection = settingsSection.style.display === "block" ? "settingsSection" : (userDetails.style.display === "block" ? "userDetails" : (passwordSection.style.display === "block" ? "passwordSection" : previousSection));
            settingsSection.style.display = "none";
            fontSettingsSection.style.display = "block";
            languageSettingsSection.style.display = "none";
            passwordSection.style.display = "none";
            userDetails.style.display = "none";
            popupTitle.textContent = getTranslation("font_settings");
            backBtn.style.display = "inline-block";
            settingsBtn.style.display = "none";
            updateTranslations();
        }

        function displayLanguageOptions() {
            const settingsSection = document.getElementById("settingsSection");
            const fontSettingsSection = document.getElementById("fontSettingsSection");
            const languageSettingsSection = document.getElementById("languageSettingsSection");
            const passwordSection = document.getElementById("passwordSection");
            const userDetails = document.getElementById("userDetails");
            const popupTitle = document.getElementById("popupTitle");
            const backBtn = document.getElementById("backBtn");
            const settingsBtn = document.getElementById("settingsBtn");

            previousSection = settingsSection.style.display === "block" ? "settingsSection" : (userDetails.style.display === "block" ? "userDetails" : (passwordSection.style.display === "block" ? "passwordSection" : previousSection));
            settingsSection.style.display = "none";
            fontSettingsSection.style.display = "none";
            languageSettingsSection.style.display = "block";
            passwordSection.style.display = "none";
            userDetails.style.display = "none";
            popupTitle.textContent = getTranslation("language_settings");
            backBtn.style.display = "inline-block";
            settingsBtn.style.display = "none";
            updateTranslations();
        }

        function navigateBack() {
            const settingsSection = document.getElementById("settingsSection");
            const fontSettingsSection = document.getElementById("fontSettingsSection");
            const languageSettingsSection = document.getElementById("languageSettingsSection");
            const passwordSection = document.getElementById("passwordSection");
            const userDetails = document.getElementById("userDetails");
            const popupTitle = document.getElementById("popupTitle");
            const backBtn = document.getElementById("backBtn");
            const settingsBtn = document.getElementById("settingsBtn");

            fontSettingsSection.style.display = "none";
            languageSettingsSection.style.display = "none";
            settingsSection.style.display = "none";
            userDetails.style.display = "none";
            passwordSection.style.display = "none";

            if (previousSection === "settingsSection") {
                settingsSection.style.display = "block";
                popupTitle.textContent = getTranslation("settings");
                backBtn.style.display = previousSection === "userDetails" || previousSection === "passwordSection" ? "inline-block" : "none";
                settingsBtn.style.display = "none";
            } else if (previousSection === "userDetails") {
                userDetails.style.display = "block";
                popupTitle.textContent = getTranslation("my_account");
                backBtn.style.display = "none";
                settingsBtn.style.display = "inline-block";
                renderUserDetails();
            } else if (previousSection === "passwordSection") {
                passwordSection.style.display = "block";
                popupTitle.textContent = getTranslation("verification");
                backBtn.style.display = "none";
                settingsBtn.style.display = "inline-block";
            } else {
                closePopup();
            }
            updateTranslations();
        }

        function applyFont(font) {
            try {
                const lang = localStorage.getItem("language") || "en";
                if (lang !== "te") {
                    document.documentElement.style.setProperty("--font-family", font === "default" ? "'Poppins', sans-serif" : "'Times New Roman', serif");
                    localStorage.setItem("font", font);
                }
                document.getElementById("fontDefaultTop").checked = font === "default";
                document.getElementById("fontSerifTop").checked = font === "serif";
                document.getElementById("fontDefault").checked = font === "default";
                document.getElementById("fontSerif").checked = font === "serif";
            } catch (e) {
                console.error("Error applying or storing font:", e);
            }
        }

        function applyTheme(theme) {
            try {
                const validThemes = ["light", "dark"];
                theme = validThemes.includes(theme) ? theme : "dark";
                document.body.classList.remove("light-theme", "dark-theme");
                document.body.classList.add(`${theme}-theme`);
                localStorage.setItem("theme", theme);
                document.getElementById("themeToggle").checked = theme === "light";
                document.getElementById("themeDarkTop").checked = theme === "dark";
                document.getElementById("themeLightTop").checked = theme === "light";
            } catch (e) {
                console.error("Error applying or storing theme:", e);
                document.body.classList.remove("light-theme", "dark-theme");
                document.body.classList.add("dark-theme");
            }
        }

        function applyLanguage(lang) {
            try {
                const validLanguages = ["en", "te"];
                lang = validLanguages.includes(lang) ? lang : "en";
                localStorage.setItem("language", lang);
                document.getElementById("langEnglishTop").checked = lang === "en";
                document.getElementById("langTeluguTop").checked = lang === "te";
                document.getElementById("langEnglish").checked = lang === "en";
                document.getElementById("langTelugu").checked = lang === "te";
                
                document.documentElement.lang = lang;
                if (lang === "te") {
                    document.documentElement.style.setProperty("--font-family", "'Noto Serif Telugu', sans-serif");
                } else {
                    const savedFont = localStorage.getItem("font") || "default";
                    document.documentElement.style.setProperty("--font-family", savedFont === "default" ? "'Poppins', sans-serif" : "'Times New Roman', serif");
                }

                updateTranslations();
                if (document.getElementById("userDetails").style.display === "block") {
                    renderUserDetails();
                }
            } catch (e) {
                console.error("Error applying or storing language:", e);
                applyLanguage("en");
            }
        }

        function getTranslation(key) {
            const lang = localStorage.getItem("language") || "en";
            return translations[lang][key] || translations.en[key] || key;
        }

        function updateTranslations() {
            const elements = document.querySelectorAll("[data-i18n]");
            elements.forEach(element => {
                const key = element.getAttribute("data-i18n");
                if (key.startsWith("[placeholder]")) {
                    element.placeholder = getTranslation(key.replace("[placeholder]", ""));
                } else if (key.startsWith("[title]")) {
                    element.title = getTranslation(key.replace("[title]", ""));
                } else {
                    // Only update text content if the element has no child elements with data-i18n
                    if (!element.querySelector("[data-i18n]")) {
                        // Preserve any child elements or dynamic values
                        const currentHTML = element.innerHTML;
                        const translation = getTranslation(key);
                        if (currentHTML.includes("<strong>")) {
                            // Replace only the translatable part, preserving dynamic values
                            element.innerHTML = currentHTML.replace(/^[^:]+/, translation);
                        } else {
                            element.textContent = translation;
                        }
                    }
                }
            });
        }

        function toggleTheme() {
            const themeToggle = document.getElementById("themeToggle");
            const theme = themeToggle.checked ? "light" : "dark";
            applyTheme(theme);
        }

        function resetTheme() {
            try {
                localStorage.removeItem("theme");
                applyTheme("dark");
                document.getElementById("themeToggle").checked = false;
                document.getElementById("themeDarkTop").checked = true;
                document.getElementById("themeLightTop").checked = false;
            } catch (e) {
                console.error("Error resetting theme:", e);
            }
        }

        const accountAccess = document.querySelector('.account-access');
        const sentinel = document.createElement('div');
        sentinel.style.height = '1px';
        document.querySelector('.container').insertBefore(sentinel, accountAccess);

        const observer = new IntersectionObserver(
            (entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        accountAccess.classList.remove('sticky');
                    } else {
                        accountAccess.classList.add('sticky');
                    }
                });
            },
            {
                root: null,
                rootMargin: '-1px 0px 0px 0px',
                threshold: 0
            }
        );

        observer.observe(sentinel);

        function closePopup() {
            document.getElementById("accountPopup").classList.remove("show");
            document.getElementById("popupOverlay").classList.remove("show");
            setTimeout(() => {
                document.getElementById("accountPopup").style.display = "none";
                document.getElementById("popupOverlay").style.display = "none";
            }, 300);
            previousSection = null;
            currentUser = null;
        }

        document.getElementById("popupOverlay")?.addEventListener("click", closePopup);
        document.getElementById("passwordInput")?.addEventListener("keypress", function(event) {
            if (event.key === "Enter") authenticateUser();
        });

        document.addEventListener("DOMContentLoaded", () => {
            const customMenu = document.querySelector(".custom-menu");

            document.addEventListener("contextmenu", (event) => {
                event.preventDefault();
                if (customMenu) {
                    customMenu.style.display = "block";
                    customMenu.style.top = `${event.pageY}px`;
                    customMenu.style.left = `${event.pageX}px`;
                }
            });

            document.addEventListener("click", () => {
                if (customMenu) {
                    customMenu.style.display = "none";
                }
            });
        });
